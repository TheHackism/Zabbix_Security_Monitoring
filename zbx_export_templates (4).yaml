zabbix_export:
  version: '7.4'
  template_groups:
    - uuid: 8047a30bd50f456ca114be2f443ad35b
      name: 'Honey Pot'
  templates:
    - uuid: 24da69d7b1fa486daa15431c535f4438
      template: HoneyPot
      name: HoneyPot
      groups:
        - name: 'Honey Pot'
      items:
        - uuid: 15ce4efceb5c45ad9e9657a30236f733
          name: 'Honeypot BusyBox'
          type: TRAP
          key: honeypot.alert
          value_type: TEXT
          triggers:
            - uuid: 2b65ea084be3492dbd02754746db1ff3
              expression: 'find(/HoneyPot/honeypot.alert,,"like","busybox attack")=1'
              name: 'busybox attack'
              priority: WARNING
        - uuid: 0d083f82a7e94c81875505fe26f620ea
          name: 'Password change attack'
          type: TRAP
          key: honeypot.passchange
          value_type: TEXT
          triggers:
            - uuid: fdd5d6a611a9485582c0119d53b925c7
              expression: 'find(/HoneyPot/honeypot.passchange,,"like","password change attack")=1'
              name: 'Password Change Attack'
              priority: WARNING
        - uuid: 0b639100ccee44fb81f9769938c07a1b
          name: 'Honeypot Unknown Attack'
          type: TRAP
          key: honeypot.unknown
          value_type: TEXT
          triggers:
            - uuid: ee39d49dd7184fa386d3f96c2f289f56
              expression: 'find(/HoneyPot/honeypot.unknown,,"like","unknown attack")=1'
              name: 'busybox attack'
              priority: WARNING
        - uuid: b1a47efc72e94da7a98d02926d207ee0
          name: 'TTY Attack'
          type: SSH
          key: 'ssh.run[tty.attempt,{HOST.IP},12222]'
          value_type: CHAR
          params: 'ls -latr /srv/cowrie/var/lib/cowrie/tty'
          username: hackism
          password: 'add your password here' 
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  // Split input into lines
                  var lines = value.trim().split("\n");
                  
                  // Filter only file entries (skip "total" and "..")
                  var entries = lines.filter(function(line) {
                      return line.match(/^\-rw/);
                  });
                  
                  // If no entries found, return a safe default
                  if (entries.length === 0) {
                      return "no_data";
                  }
                  
                  // Get the last entry
                  var lastEntry = entries[entries.length - 1];
                  
                  // Split into parts
                  var parts = lastEntry.trim().split(/\s+/);
                  
                  // Extract date/time and filename
                  var month = parts[4];
                  var day   = parts[5];
                  var time  = parts[6];
                  var file  = parts[7];
                  
                  // Build a combined output
                  var output = file + " | " + month + " " + day + " " + time;
                  
                  // Always return something
                  return output;
          timeout: 30s
          triggers:
            - uuid: ad29c840768544a0b4a7560ffc042f4c
              expression: 'change(/HoneyPot/ssh.run[tty.attempt,{HOST.IP},12222])<>0'
              recovery_mode: NONE
              name: 'tty attack alert'
              priority: HIGH
              description: 'Alert if the value changes. Recovery is only possible manually.'
              manual_close: 'YES'
